ALTER TABLE dbo.ExtendedPropertyDefinition ADD
	EditTaskId uniqueidentifier NULL
GO

ALTER TABLE dbo.ExtendedPropertyDefinition ADD CONSTRAINT
	FK_ExtendedPropertyDefinition#EditTask# FOREIGN KEY
	(
	EditTaskId
	) REFERENCES dbo.SecurityTask
	(
	ID
	) ON UPDATE  NO ACTION 
	 ON DELETE  NO ACTION 
GO

-- If there is no new category for Editing but there IS the generic "Free Lunch" cat is there, then add them
if not exists(select * from SecurityTaskCategory where id='CEED3923-DB75-469D-BAAE-A0EB40519502') AND 
	EXISTS (select * from SecurityTaskCategory where id='CF81565B-48FF-493D-9760-7FD6459ED6C8' )
BEGIN
	INSERT INTO SecurityTaskCategory VALUES ('CEED3923-DB75-469D-BAAE-A0EB40519502', 'Edit', 'CF81565B-48FF-493D-9760-7FD6459ED6C8', NULL,2, NULL,NULL);
	INSERT INTO SecurityTaskType VALUES ('B5480E07-AD63-48C6-A143-078C790EB01E', 'Edit Student Free / Reduced Lunch', 'Edit Student Free / Reduced Lunch')
	INSERT INTO SecurityTask VALUES ('B5480E07-AD63-48C6-A143-078C790EB01E','CEED3923-DB75-469D-BAAE-A0EB40519502', 2,  'F069CEA9-B0F4-44E2-AD7D-EE03E3F7C0D4',NULL,'C4178BB5-6EC7-4440-ABC0-7B11874AB6A0')
	
	INSERT INTO SecurityTaskCategory VALUES ('CFF7BD42-8D86-42F5-9776-E1411001D702', 'View', 'CF81565B-48FF-493D-9760-7FD6459ED6C8', NULL,1, NULL,NULL);
	
	UPDATE SecurityTask
	SET CategoryID = 'CFF7BD42-8D86-42F5-9776-E1411001D702'
	WHERE ID = '265727C5-B2D8-4303-BC91-027D4428C5A4'

	UPDATE SecurityTask
	SET CategoryID = 'CEED3923-DB75-469D-BAAE-A0EB40519502'
	WHERE ID='C4178BB5-6EC7-4440-ABC0-7B11874AB6A0'

	UPDATE ExtendedPropertyDefinition
	SET EditTaskId = 'C4178BB5-6EC7-4440-ABC0-7B11874AB6A0'
	WHERE ID ='754588E5-63B0-4B28-86AE-AAF5DB0B0F6B'	
END